---
title: 'Recurring Payments - Credential on File'
search_results: 'Global Payments - Recurring Payments - Credential on File'
subtitle: 'Learn how to flag COF transactions to adhere to card brand mandates'
tag: 'rest'
created: '29/08/2024'
---
In this guide, you’ll learn how to correctly pass Credential on File (COF) data for the following use cases: 

* One-Click Checkout – Unscheduled payments triggered by the cardholder.
* Recurring & Installments – A subscription/variable amount billing agreement or regular payments for a fixed term triggered by the merchant.
* Account Auto Top-Up – Unscheduled payments triggered by the merchant.

Each use case involves an initial CIT where the customer transacts with the merchant and agrees to store their card (customer signup). Depending on the use case, the customer might also consent to an installment/subscription or agree that their card can be charged without their direct involvement. So, first we’ll cover that initial step and then go into each specific use case. 

The following table summarizes the required data for each use case.

| Data | First Transaction / Customer Signup | Subsequent Transaction: One-Click Checkout | Subsequent Transaction: Recurring or Installment | Subsequent Transaction: Auto Account Top-Up |
| --- | --- | --- | --- | --- |
| Model | UNSCHEDULED | UNSCHEDULED | RECURRING or INSTALLMENT	| UNSCHEDULED |
| Initiator | PAYER | PAYER | MERCHANT | MERCHANT |
| Sequence | FIRST | SUBSEQUENT	| SUBSEQUENT |	SUBSEQUENT |
| Brand Reference| N/A | N/A | N/A | Required | Required |

## What is COF?

COF is a way of identifying stored card transactions. The location of the stored card details doesn't matter — the details could be held in our Card Storage solution or stored securely by the merchant or by a third party for merchant use. 

The purpose of the COF mandate from the card schemes, such as Visa or Mastercard, is to help reduce fraud by requiring merchants to include certain fields in the authorization message when using a customer’s stored credentials for payments. These COF fields indicate to issuers and acquirers that the merchant has a prior arrangement with the customer to store their card details and potentially to make subsequent payments on their behalf. This benefits the merchant and cardholder by identifying a more trusted transaction, which can enable scenarios like one-click checkout or [recurring transactions](/docs/payments/recurring/overview).

Transactions using stored card details are either customer-initiated (payer) (CIT) or merchant-initiated (MIT).

## COF data and fields

The following table describes the relevant COF data and fields.

| Field Name / Data | Description |
| --- | --- |
| Initiator | The initiator of the transaction. Allowed values: <br /> **PAYER** - Indicates a transaction that is customer-initiated (CIT). <br /> **MERCHANT** - Indicates a transaction that is merchant-initiated (MIT). |
| Model	| The relationship type the customer agreed to with the merchant and the category of transaction being processed. Allowed values: <br /> **RECURRING** - Payment with no fixed duration that continues until the customer cancels. <br /> **INSTALLMENT** - Payment of an agreed amount on the same day each month until the fixed duration ends. <br /> **UNSCHEDULED** - Oneoff payment with no fixed duration. |
| Sequence	| Indicates the stage of card storage. Allowed values: <br /> **FIRST** <br /> **SUBSEQUENT** |
| Brand Reference	| Also referred to as Scheme Reference Data (SRD). A unique identifier provided by a card scheme, such as Visa or Mastercard, that links to the payment history between the customer and merchant. Also referred to as Transaction ID or Trace ID, depending on the card scheme. This will appear in the response message of an initial transaction. |

## First transaction - Customer signup

The first transaction is a CIT. For example, the customer is making a payment on the merchant’s website for the first time or choosing a subscription or installment product. With this in mind, the model needs to match the agreement that the customer is signing up for. In our example, it’s Unscheduled, but it could be Installment or Recurring.

For this transaction, initiator and sequence will always be Payer and First, respectively.

If future transactions using this stored card are merchant-initiated (MITs), the first transaction must include 3D Secure 2 payment authentication with the Challenge Mandated flag passed to the Issuer. You must also store the brand references for future transactions. For more information, see our [Merchant-Initiated Transactions](/docs/MIT) article.

#### Sample request

<CodeGroup>
<Code id="JSON" title="JSON" language="JSON" active>
```json
curl --location --request POST 'https://apis.sandbox.globalpay.com/ucp/transactions' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer 2orSiiEoQc82EMBUNDyX1DS7guO3' \
--header 'Accept: application/json' \
--header 'X-GP-Version: 2021-03-22' \
--data-raw '{
    "account_id": "TRA_6716058969854a48b33347043ff8225f",
    "channel": "CNP",
    "type": "SALE",
    "amount": "100",
    "currency": "EUR",
    "reference": "14406011",
    "country": "IE",
    "initiator": "PAYER",
    "stored_credential": {
        "model": "UNSCHEDULED",
        "sequence": "FIRST"
    },
    "payment_method": {
        "name": "James Mason",
        "entry_mode": "ECOM",
        "card": {
            "number": "4263970000005262",
            "expiry_month": "09",
            "expiry_year": "22",
            "cvv": "123"
        },
        "authentication": {
            "three_ds": {
                "server_trans_ref": "vJ9NXpFueXsAqeb4iAbJJbe+66s=",
                "value": "AAACBUGDZYYYIgGFGYNlAAAAAAA=",
                "eci": "05",
                "message_version": "2.1.0"
            }
        }
    }
}'
```
</Code>
<Code id="java" title="JAVA" language="java">
```
GpApiConfig config = new GpApiConfig();
config.setAppId(APP_ID);
config.setAppKey(APP_KEY);
config.setChannel(Channel.CardNotPresent);
config.setCountry("IE");
config.setEnvironment(Environment.TEST);

ServicesContainer.configureService(config);

CreditCardData card = new CreditCardData();
card.setNumber("4263970000005262");
card.setExpMonth(DateTime.now().getMonthOfYear());
card.setExpYear(DateTime.now().getYear() + 1);
card.setCvn("123");
card.setCardHolderName("James Mason");

ThreeDSecure threeDSecure = new ThreeDSecure();
threeDSecure.setProviderServerTransRef("vJ9NXpFueXsAqeb4iAbJJbe+66s=");
threeDSecure.setAuthenticationValue("AAACBUGDZYYYIgGFGYNlAAAAAAA=");
threeDSecure.setEci("05");
threeDSecure.setMessageVersion("2.1.0");
card.setThreeDSecure(threeDSecure);

StoredCredential storedCredential = new StoredCredential();
storedCredential.setInitiator(StoredCredentialInitiator.CardHolder);
storedCredential.setType(StoredCredentialType.Unscheduled);
storedCredential.setSequence(StoredCredentialSequence.First);

try {
    Transaction response = card.charge(new BigDecimal("1.00"))
            .withCurrency("EUR")
            .withClientTransactionId("14406011")
            .withStoredCredential(storedCredential)
            .execute();

    // API raw response key "id"
    String transactionId = response.getTransactionId();
    // API raw response key "amount"
    BigDecimal amount = response.getBalanceAmount();
    // API raw response key "batch_id"
    String batchId = response.getBatchSummary().getBatchReference();
    // API raw response key "type"
    TransactionType transactionType = response.getTransactionReference().getOriginalTransactionType();
    // API raw response key "reference"
    String referenceNumber = response.getReferenceNumber();
    // API raw response key "status"
    String transactionStatus = response.getResponseMessage();
    // API raw response key "time_created"
    String timeCreated = response.getTimestamp();
    // API raw response key "action->result_code"
    String responseCode = response.getResponseCode();
    // API raw response key "payment_method->card->brand_reference"
    String cardBrandReference = response.getCardBrandTransactionId();
    // API raw response key "payment_method->card->authcode"
    String authCode = response.getAuthorizationCode();
    // API raw response key "payment_method->card->cvv_result"
    String cvnResponseMessage = response.getCvnResponseMessage();
    // API raw response key "payment_method->card->brand"();
    String cardType = response.getCardDetails().getBrand();
    // API raw response key "payment_method->card->masked_number_last4"
    String maskedNumberLast4 = response.getCardDetails().getMaskedNumberLast4();
    // API raw response key "payment_method->card->provider->result"
    String cardIssuerResult = response.getCardIssuerResponse().getResult();
    // API raw response key "payment_method->card->provider->cvv_result"
    String cardIssuerCvv = response.getCardIssuerResponse().getCvvResult();
    // API raw response key "payment_method->card->provider->avs_address_result"
    String cardIssuerAvsAddressResult = response.getCardIssuerResponse().getAvsAddressResult();
    // API raw response key "payment_method->card->provider->avs_postal_code_result"
    String cardIssuerAvsPostalCodeResult = response.getCardIssuerResponse().getAvsPostalCodeResult();
    // API raw response key "risk_assessment->mode"
    String fraudResponseMode = response.getFraudFilterResponse().getFraudResponseMode();
    // API raw response key "risk_assessment->result"
    String fraudResponseResult = response.getFraudFilterResponse().getFraudResponseResult();
    // API raw response key "risk_assessment->rules"
    List<FraudRule> fraudResponseRules = response.getFraudFilterResponse().getFraudResponseRules();
} catch (ApiException e) {
    // TODO: Add your exception handling here
}
```
</Code>
<Code id="net" title=".NET" language="dotnet">
```
GpApiConfig config = new GpApiConfig
{
	AppId = "AppId",
	AppKey = "AppKey",
	Channel = Channel.CardNotPresent,
	Environment = Environment.TEST,
	Country = "IE"
};
ServicesContainer.ConfigureService(config);

CreditCardData card = new CreditCardData {
	Number = "4263970000005262",
	ExpMonth = DateTime.Now.Month,
	ExpYear = DateTime.Now.Year + 1,
	Cvn = "123",
	CardHolderName = "James Mason",
	ThreeDSecure = new ThreeDSecure {
		ProviderServerTransRef = "vJ9NXpFueXsAqeb4iAbJJbe+66s=",
		AuthenticationValue = "AAACBUGDZYYYIgGFGYNlAAAAAAA=",
		Eci = "05",
		MessageVersion = "2.1.0"
	}
};
StoredCredential storeCredentials = new StoredCredential
{
	Initiator = StoredCredentialInitiator.CardHolder,
	Type = StoredCredentialType.Unscheduled,
	Sequence = StoredCredentialSequence.First
};

try
{
	Transaction response = card.Charge(1m)
		.WithCurrency("EUR")
		.WithClientTransactionId("14406011")
		.WithStoredCredential(storeCredentials)
		.Execute(); 
	
	// API raw response key "id"
	var transactionId = response.TransactionId;
	// API raw response key "amount"
	var amount = response.AuthorizedAmount; 
	//API raw response key "batch_id"
	var batchId = response.BatchSummary.BatchReference;
	// API raw response key "reference"
	var referenceNumber = response.ReferenceNumber; 
	// API raw response key "status"
	var transactionStatus = response.ResponseMessage;
	// API raw response key "time_created"
	var timeCreated = response.Timestamp; 
	// API raw response key "action->result_code"
	var responseCode = response.ResponseCode; 
	//API raw response key "payment_method->card->brand_reference"
	var cardBrandReference = response.CardBrandTransactionId;
	// API raw response key "payment_method->card->authcode"
	var authCode = response.AuthorizationCode;
	// API raw response key "payment_method->card->cvv_result"
	var cvnResponseMessage = response.CvnResponseMessage;
	// API raw response key "payment_method->card->brand";
	var cardType = response.CardDetails.Brand;
	// API raw response key "payment_method->card->masked_number_last4"
	var maskedNumberLast4 = response.CardDetails.MaskedNumberLast4;
	//API raw response key "payment_method->card->provider->result"
	var cardIssuerResult = response.CardIssuerResponse.Result;
	//API raw response key "payment_method->card->provider->cvv_result"
	var cardIssuerCvv = response.CardIssuerResponse.CvvResult;
	//API raw response key "payment_method->card->provider->avs_address_result"
	var cardIssuerAvsAddressResult = response.CardIssuerResponse.AvsAddressResult;
	//API raw response key "payment_method->card->provider->avs_postal_code_result"
	var cardIssuerAvsPostalCodeResult = response.CardIssuerResponse.AvsPostalCodeResult;
	//API raw response key "risk_assessment->mode"
	var fraudResponseMode = response.FraudFilterResponse.FraudResponseMode;
	//API raw response key "risk_assessment->result"
	var fraudResponseResult = response.FraudFilterResponse.FraudResponseResult;
	//API raw response key "risk_assessment->rules"
	var fraudResponseRules = response.FraudFilterResponse.FraudResponseRules;
}
catch (GatewayException e)
{
	Console.WriteLine(e);
	throw;
}
```
</Code>
<Code id="PHP" title="PHP" language="php">
```
$config = new GpApiConfig();
$config->appId = 'appId';
$config->appKey = 'appKey';
$config->channel = Channel::CardNotPresent;
$config->country = 'IE';
$config->environment = Environment::TEST;
$config->requestLogger = new SampleRequestLogger(new Logger("logs"));

ServicesContainer::configureService($config);

$card = new CreditCardData();
$card->number = '4263970000005262';
$card->expMonth = date('m');
$card->expYear = date('Y', strtotime('+1 year'));
$card->cvn = '123';
$card->cardHolderName = 'James Mason';
$card->threeDSecure = new \GlobalPayments\Api\Entities\ThreeDSecure();
$card->threeDSecure->providerServerTransRef = 'vJ9NXpFueXsAqeb4iAbJJbe+66s=';
$card->threeDSecure->authenticationValue = 'AAACBUGDZYYYIgGFGYNlAAAAAAA=';
$card->threeDSecure->eci = '05';
$card->threeDSecure->messageVersion = '2.1.0';

$storeCredentials = new StoredCredential();
$storeCredentials->initiator = StoredCredentialInitiator::PAYER;
$storeCredentials->type = StoredCredentialType::UNSCHEDULED;
$storeCredentials->sequence = StoredCredentialSequence::FIRST;

try {
    $response = $card->charge(1)
        ->withCurrency("EUR")
        ->withClientTransactionId("14406011")
        ->withStoredCredential($storeCredentials)
        ->execute();
} catch (GatewayException $ex) {
    echo $ex->getMessage();
    exit();
    // TODO: Add your exception handling here
}

$transactionId = $response->transactionId; // API raw response key "id"
$amount = $response->authorizedAmount; // API raw response key "amount"
//API raw response key "batch_id"
$batchId = $response->batchSummary->batchReference;
//API raw response key "type"
$transactionType = $response->originalTransactionType;
$referenceNumber = $response->referenceNumber; // API raw response key "reference"
$transactionStatus = $response->responseMessage;// API raw response key "status"
$timeCreated = $response->timestamp; // API raw response key "time_created"
$responseCode = $response->responseCode; // API raw response key "action->result_code"
//API raw response key "payment_method->card->brand_reference"
$cardBrandReference = $response->cardBrandTransactionId;
// API raw response key "payment_method->card->authcode"
$authCode = $response->authorizationCode;
// API raw response key "payment_method->card->cvv_result"
$cvnResponseMessage = $response->cvnResponseMessage;
// API raw response key "payment_method->card->brand";
$cardType = $response->cardDetails->brand;
// API raw response key "payment_method->card->masked_number_last4"
$maskedNumberLast4 = $response->cardDetails->maskedNumberLast4;
//API raw response key "payment_method->card->provider->result"
$cardIssuerResult = $response->cardIssuerResponse->result;
//API raw response key "payment_method->card->provider->cvv_result"
$cardIssuerCvv = $response->cardIssuerResponse->cvvResult;
//API raw response key "payment_method->card->provider->avs_address_result"
$cardIssuerAvsAddressResult = $response->cardIssuerResponse->avsAddressResult;
//API raw response key "payment_method->card->provider->avs_postal_code_result"
$cardIssuerAvsPostalCodeResult = $response->cardIssuerResponse->avsPostalCodeResult;
//API raw response key "risk_assessment->mode"
$fraudResponseMode = $response->fraudFilterResponse->fraudResponseMode;
//API raw response key "risk_assessment->result"
$fraudResponseResult = $response->fraudFilterResponse->fraudResponseResult;
//API raw response key "risk_assessment->rules"
$fraudResponseRules = $response->fraudFilterResponse->fraudResponseRules;
```
</Code>
</CodeGroup>

#### Sample response

<Code id="JSON" title="JSON" language="JSON" active>
```json
{
    "id": "TRN_wyU5fw3aUJZZXZ9OzdxHhLYete9tYk_14406011",
    "time_created": "2022-05-20T14:18:05.428Z",
    "type": "SALE",
    "status": "CAPTURED",
    "channel": "CNP",
    "capture_mode": "AUTO",
    "amount": "100",
    "currency": "EUR",
    "country": "IE",
    "merchant_id": "MER_c4c0df11039c48a9b63701adeaa296c3",
    "merchant_name": "Sandbox_merchant_2",
    "account_id": "TRA_6716058969854a48b33347043ff8225f",
    "account_name": "Transaction_Processing",
    "reference": "14406011",
    "payment_method": {
        "result": "00",
        "message": "[ test system ] AUTHORISED",
        "entry_mode": "ECOM",
        "authentication": {
            "cavv_result": ""
        },
        "card": {
            "brand": "VISA",
            "masked_number_last4": "XXXXXXXXXXXX5262",
            "authcode": "12345",
            "brand_reference": "ef5FXsbbtJfXKhh0",
            "brand_time_created": "",
            "provider": {
                "result": "00",
                "cvv_result": "M",
                "avs_address_result": "M",
                "avs_postal_code_result": "M"
            }
        }
    },
    "batch_id": "BAT_1092561",
    "action": {
        "id": "ACT_wyU5fw3aUJZZXZ9OzdxHhLYete9tYk",
        "type": "AUTHORIZE",
        "time_created": "2022-05-20T14:18:05.428Z",
        "result_code": "SUCCESS",
        "app_id": "i9R0byBBor6RqTQNj3g4MuVBwH5rd7yR",
        "app_name": "demo_app"
    }
}
```
</Code>

## Subsequent transaction examples
In our code samples, we use a stored card / payment method (also known as a token), but a merchant might store the card data themselves or use a third party.

### One-click checkout
This use case is a CIT. For example, the customer returns to the merchant’s website and is presented with their previously stored card. It is recommended to also capture the security code (CVV) and, depending on the region, perform 3D Secure 2 authentication.

<Infobox>
  Brand reference is not required for subsequent CITs.
  </Infobox>
  
#### Sample request

<CodeGroup>
<Code id="JSON" title="JSON" language="JSON" active>
```json
curl --location --request POST 'https://apis.sandbox.globalpay.com/ucp/transactions' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer 2orSiiEoQc82EMBUNDyX1DS7guO3' \
--header 'Accept: application/json' \
--header 'X-GP-Version: 2021-03-22' \
--data-raw '{
    "account_id": "TRA_6716058969854a48b33347043ff8225f",
    "channel": "CNP",
    "type": "SALE",
    "amount": "100",
    "currency": "EUR",
    "reference": "53509251",
    "country": "IE",
    "initiator": "PAYER",
    "stored_credential": {
        "model": "UNSCHEDULED",
        "sequence": "SUBSEQUENT"
    },
    "payment_method": {
        "name": "James Mason",
        "entry_mode": "ECOM",
        "id": "PMT_850924e2-d2bd-4724-bb59-12ae1cec392d",
        "card": {
            "cvv": "123"
        },
        "authentication": {
            "three_ds": {
                "server_trans_ref": "vJ9NXpFueXsAqeb4iAbJJbe+66s=",
                "value": "AAACBUGDZYYYIgGFGYNlAAAAAAA=",
                "eci": "05",
                "message_version": "2.1.0"
            }
        }
    }
}'
```
</Code>
<Code id="java" title="JAVA" language="java">
```
GpApiConfig config = new GpApiConfig();
config.setAppId(APP_ID);
config.setAppKey(APP_KEY);
config.setChannel(Channel.CardNotPresent);
config.setCountry("IE");
config.setEnvironment(Environment.TEST);

ServicesContainer.configureService(config);

CreditCardData card = new CreditCardData();
card.setToken("PMT_7554986a-1e77-4c75-a80f-5889d0621c13");
card.setCvn("123");
card.setCardHolderName("James Mason");

ThreeDSecure threeDSecure = new ThreeDSecure();
threeDSecure.setProviderServerTransRef("vJ9NXpFueXsAqeb4iAbJJbe+66s=");
threeDSecure.setAuthenticationValue("AAACBUGDZYYYIgGFGYNlAAAAAAA=");
threeDSecure.setEci("05");
threeDSecure.setMessageVersion("2.1.0");
card.setThreeDSecure(threeDSecure);

StoredCredential storedCredential = new StoredCredential();
storedCredential.setInitiator(StoredCredentialInitiator.CardHolder);
storedCredential.setType(StoredCredentialType.Unscheduled);
storedCredential.setSequence(StoredCredentialSequence.Subsequent);

try {
    Transaction response = card.charge(new BigDecimal("1.00"))
            .withCurrency("EUR")
            .withClientTransactionId("53509251")
            .withStoredCredential(storedCredential)
            .execute();

    // API raw response key "id"
    String transactionId = response.getTransactionId();
    // API raw response key "amount"
    BigDecimal amount = response.getBalanceAmount();
    // API raw response key "batch_id"
    String batchId = response.getBatchSummary().getBatchReference();
    // API raw response key "type"
    TransactionType transactionType = response.getTransactionReference().getOriginalTransactionType();
    // API raw response key "reference"
    String referenceNumber = response.getReferenceNumber();
    // API raw response key "status"
    String transactionStatus = response.getResponseMessage();
    // API raw response key "time_created"
    String timeCreated = response.getTimestamp();
    // API raw response key "action->result_code"
    String responseCode = response.getResponseCode();
    // API raw response key "payment_method->card->brand_reference"
    String cardBrandReference = response.getCardBrandTransactionId();
    // API raw response key "payment_method->card->authcode"
    String authCode = response.getAuthorizationCode();
    // API raw response key "payment_method->card->avs_postal_code_result"
    String avsResponseCode = response.getAvsResponseCode();
    // API raw response key "payment_method->card->->avs_address_result"
    String avsAddressResponse = response.getAvsAddressResponse();
    // API raw response key "payment_method->card->cvv_result"
    String cvnResponseMessage = response.getCvnResponseMessage();
    // API raw response key "payment_method->card->brand"();
    String cardType = response.getCardDetails().getBrand();
    // API raw response key "payment_method->card->masked_number_last4"
    String maskedNumberLast4 = response.getCardDetails().getMaskedNumberLast4();
    // API raw response key "payment_method->card->provider->result"
    String cardIssuerResult = response.getCardIssuerResponse().getResult();
    // API raw response key "payment_method->card->provider->cvv_result"
    String cardIssuerCvv = response.getCardIssuerResponse().getCvvResult();
    // API raw response key "payment_method->card->provider->avs_address_result"
    String cardIssuerAvsAddressResult = response.getCardIssuerResponse().getAvsAddressResult();
    // API raw response key "payment_method->card->provider->avs_postal_code_result"
    String cardIssuerAvsPostalCodeResult = response.getCardIssuerResponse().getAvsPostalCodeResult();
    // API raw response key "risk_assessment->mode"
    String fraudResponseMode = response.getFraudFilterResponse().getFraudResponseMode();
    // API raw response key "risk_assessment->result"
    String fraudResponseResult = response.getFraudFilterResponse().getFraudResponseResult();
    // API raw response key "risk_assessment->rules"
    List<FraudRule> fraudResponseRules = response.getFraudFilterResponse().getFraudResponseRules();
} catch (ApiException e) {
    // TODO: Add your exception handling here
}
```
</Code>
<Code id="net" title=".NET" language="dotnet">
```
GpApiConfig config = new GpApiConfig
{
	AppId = "AppId",
	AppKey = "AppKey",
	Channel = Channel.CardNotPresent,
	Environment = Environment.TEST,
	Country = "IE"
};
ServicesContainer.ConfigureService(config);

CreditCardData card = new CreditCardData {
	Token = "PMT_7554986a-1e77-4c75-a80f-5889d0621c13",
	Cvn = "123",
	CardHolderName = "James Mason",
	ThreeDSecure = new ThreeDSecure {
		ProviderServerTransRef = "vJ9NXpFueXsAqeb4iAbJJbe+66s=",
		AuthenticationValue = "AAACBUGDZYYYIgGFGYNlAAAAAAA=",
		Eci = "05",
		MessageVersion = "2.1.0"
	}
};
StoredCredential storeCredentials = new StoredCredential
{
	Initiator = StoredCredentialInitiator.CardHolder,
	Type = StoredCredentialType.Unscheduled,
	Sequence = StoredCredentialSequence.Subsequent
};

try
{
	Transaction response = card.Charge(1m)
		.WithCurrency("EUR")
		.WithClientTransactionId("53509251")
		.WithStoredCredential(storeCredentials)
		.Execute(); 
	
	// API raw response key "id"
	var transactionId = response.TransactionId;
	// API raw response key "amount"
	var amount = response.AuthorizedAmount; 
	//API raw response key "batch_id"
	var batchId = response.BatchSummary.BatchReference;
	// API raw response key "reference"
	var referenceNumber = response.ReferenceNumber; 
	// API raw response key "status"
	var transactionStatus = response.ResponseMessage;
	// API raw response key "time_created"
	var timeCreated = response.Timestamp; 
	// API raw response key "action->result_code"
	var responseCode = response.ResponseCode; 
	//API raw response key "payment_method->card->brand_reference"
	var cardBrandReference = response.CardBrandTransactionId;
	// API raw response key "payment_method->card->authcode"
	var authCode = response.AuthorizationCode;
	// API raw response key "payment_method->card->cvv_result"
	var cvnResponseMessage = response.CvnResponseMessage;
	// API raw response key "payment_method->card->brand";
	var cardType = response.CardDetails.Brand;
	// API raw response key "payment_method->card->masked_number_last4"
	var maskedNumberLast4 = response.CardDetails.MaskedNumberLast4;
	//API raw response key "payment_method->card->provider->result"
	var cardIssuerResult = response.CardIssuerResponse.Result;
	//API raw response key "payment_method->card->provider->cvv_result"
	var cardIssuerCvv = response.CardIssuerResponse.CvvResult;
	//API raw response key "payment_method->card->provider->avs_address_result"
	var cardIssuerAvsAddressResult = response.CardIssuerResponse.AvsAddressResult;
	//API raw response key "payment_method->card->provider->avs_postal_code_result"
	var cardIssuerAvsPostalCodeResult = response.CardIssuerResponse.AvsPostalCodeResult;
	//API raw response key "risk_assessment->mode"
	var fraudResponseMode = response.FraudFilterResponse.FraudResponseMode;
	//API raw response key "risk_assessment->result"
	var fraudResponseResult = response.FraudFilterResponse.FraudResponseResult;
	//API raw response key "risk_assessment->rules"
	var fraudResponseRules = response.FraudFilterResponse.FraudResponseRules;
}
catch (GatewayException e)
{
	Console.WriteLine(e);
	throw;
}  
```
</Code>
<Code id="PHP" title="PHP" language="php">
```
$config = new GpApiConfig();
$config->appId = 'appId';
$config->appKey = 'appKey';
$config->channel = Channel::CardNotPresent;
$config->country = 'IE';
$config->environment = Environment::TEST;
$config->requestLogger = new SampleRequestLogger(new Logger("logs"));

ServicesContainer::configureService($config);

$card = new CreditCardData();
$card->token = 'PMT_7554986a-1e77-4c75-a80f-5889d0621c13';
$card->cvn = '123';
$card->cardHolderName = 'James Mason';
$card->threeDSecure = new \GlobalPayments\Api\Entities\ThreeDSecure();
$card->threeDSecure->providerServerTransRef = 'vJ9NXpFueXsAqeb4iAbJJbe+66s=';
$card->threeDSecure->authenticationValue = 'AAACBUGDZYYYIgGFGYNlAAAAAAA=';
$card->threeDSecure->eci = '05';
$card->threeDSecure->messageVersion = '2.1.0';

$storeCredentials = new StoredCredential();
$storeCredentials->initiator = StoredCredentialInitiator::PAYER;
$storeCredentials->type = StoredCredentialType::UNSCHEDULED;
$storeCredentials->sequence = StoredCredentialSequence::SUBSEQUENT;

try {
    $response = $card->charge(1)
        ->withCurrency("EUR")
        ->withClientTransactionId("53509251")
        ->withStoredCredential($storeCredentials)
        ->execute();
} catch (GatewayException $ex) {
    echo $ex->getMessage();
    exit();
    // TODO: Add your exception handling here
}

$transactionId = $response->transactionId; // API raw response key "id"
$amount = $response->authorizedAmount; // API raw response key "amount"
//API raw response key "batch_id"
$batchId = $response->batchSummary->batchReference;
//API raw response key "type"
$transactionType = $response->originalTransactionType;
$referenceNumber = $response->referenceNumber; // API raw response key "reference"
$transactionStatus = $response->responseMessage;// API raw response key "status"
$timeCreated = $response->timestamp; // API raw response key "time_created"
$responseCode = $response->responseCode; // API raw response key "action->result_code"
//API raw response key "payment_method->card->brand_reference"
$cardBrandReference = $response->cardBrandTransactionId;
// API raw response key "payment_method->card->authcode"
$authCode = $response->authorizationCode;
//API raw response key "payment_method->card->avs_postal_code_result"
$avsResponseCode = $response->avsResponseCode;
//API raw response key "payment_method->card->->avs_address_result"
$avsAddressResponse  = $response->avsAddressResponse;
// API raw response key "payment_method->card->cvv_result"
$cvnResponseMessage = $response->cvnResponseMessage;
// API raw response key "payment_method->card->brand";
$cardType = $response->cardDetails->brand;
// API raw response key "payment_method->card->masked_number_last4"
$maskedNumberLast4 = $response->cardDetails->maskedNumberLast4;
//API raw response key "payment_method->card->provider->result"
$cardIssuerResult = $response->cardIssuerResponse->result;
//API raw response key "payment_method->card->provider->cvv_result"
$cardIssuerCvv = $response->cardIssuerResponse->cvvResult;
//API raw response key "payment_method->card->provider->avs_address_result"
$cardIssuerAvsAddressResult = $response->cardIssuerResponse->avsAddressResult;
//API raw response key "payment_method->card->provider->avs_postal_code_result"
$cardIssuerAvsPostalCodeResult = $response->cardIssuerResponse->avsPostalCodeResult;
//API raw response key "risk_assessment->mode"
$fraudResponseMode = $response->fraudFilterResponse->fraudResponseMode;
//API raw response key "risk_assessment->result"
$fraudResponseResult = $response->fraudFilterResponse->fraudResponseResult;
//API raw response key "risk_assessment->rules"
$fraudResponseRules = $response->fraudFilterResponse->fraudResponseRules;
```
</Code>
</CodeGroup>

#### Sample response

<Code id="JSON" title="JSON" language="JSON" active>
```json
{
    "id": "TRN_G8Kj4BTiKOS67ywj9V3nbn5hLpet6f_53509251",
    "time_created": "2022-05-20T16:43:27.568Z",
    "type": "SALE",
    "status": "CAPTURED",
    "channel": "CNP",
    "capture_mode": "AUTO",
    "amount": "100",
    "currency": "EUR",
    "country": "IE",
    "merchant_id": "MER_c4c0df11039c48a9b63701adeaa296c3",
    "merchant_name": "Sandbox_merchant_2",
    "account_id": "TRA_6716058969854a48b33347043ff8225f",
    "account_name": "Transaction_Processing",
    "reference": "53509251",
    "payment_method": {
        "result": "00",
        "message": "[ test system ] AUTHORISED",
        "entry_mode": "ECOM",
        "authentication": {
            "cavv_result": ""
        },
        "card": {
            "funding": "CREDIT",
            "brand": "VISA",
            "masked_number_last4": "XXXXXXXXXXXX5262",
            "authcode": "12345",
            "brand_reference": "66CX0osxtpW7hPOG",
            "brand_time_created": "",
            "tag_response": "",
            "cvv_result": "MATCHED",
            "avs_address_result": "MATCHED",
            "avs_postal_code_result": "MATCHED",
            "avs_action": "",
            "provider": {
                "result": "00",
                "cvv_result": "M",
                "avs_address_result": "M",
                "avs_postal_code_result": "M"
            }
        }
    },
    "batch_id": "BAT_1092561",
    "action": {
        "id": "ACT_G8Kj4BTiKOS67ywj9V3nbn5hLpet6f",
        "type": "AUTHORIZE",
        "time_created": "2022-05-20T16:43:27.568Z",
        "result_code": "SUCCESS",
        "app_id": "i9R0byBBor6RqTQNj3g4MuVBwH5rd7yR",
        "app_name": "demo_app"
    }
}
```
</Code>

### Recurring &amp; Installments

This use case is an MIT. For example, the merchant charges the customer’s card based on an agreed subscription or installment plan. You must supply the brand reference from the original authorization or verification when the card was first stored. When flagged correctly, MITs are deemed as out of scope for the European requirements for Strong Customer Authentication (SCA). For more information, see our [Merchant-Initiated Transactions](/docs/MIT) article.

In this example, we set the model to be Recurring, but we could also choose Installment. 

#### Sample request

<CodeGroup>
<Code id="JSON" title="JSON" language="JSON" active>
```json
curl --location --request POST 'https://apis.sandbox.globalpay.com/ucp/transactions' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer 2orSiiEoQc82EMBUNDyX1DS7guO3' \
--header 'Accept: application/json' \
--header 'X-GP-Version: 2021-03-22' \
--data-raw '{
    "account_id": "TRA_6716058969854a48b33347043ff8225f",
    "channel": "CNP",
    "type": "SALE",
    "amount": "100",
    "currency": "EUR",
    "reference": "75652561",
    "country": "IE",
    "initiator": "MERCHANT",
    "stored_credential": {
        "model": "RECURRING",
        "sequence": "SUBSEQUENT"
    },
    "payment_method": {
        "name": "James Mason",
        "entry_mode": "ECOM",
        "id": "PMT_850924e2-d2bd-4724-bb59-12ae1cec392d",
        "card": {
            "brand_reference": "wqIV3urYYTj5LkCT"
        }
    }
}'
```
</Code>
<Code id="java" title="JAVA" language="java">
```
GpApiConfig config = new GpApiConfig();
config.setAppId(APP_ID);
config.setAppKey(APP_KEY);
config.setChannel(Channel.CardNotPresent);
config.setCountry("IE");
config.setEnvironment(Environment.TEST);

ServicesContainer.configureService(config);

CreditCardData card = new CreditCardData();
card.setToken("PMT_7554986a-1e77-4c75-a80f-5889d0621c13");
card.setCardHolderName("James Mason");

StoredCredential storedCredential = new StoredCredential();
storedCredential.setInitiator(StoredCredentialInitiator.Merchant);
storedCredential.setType(StoredCredentialType.Recurring);
storedCredential.setSequence(StoredCredentialSequence.Subsequent);

String chargeCardBrandReference = "t9XevTa8Oia31WVL";

try {
    Transaction response = card.charge(new BigDecimal("1.00"))
            .withCurrency("EUR")
            .withClientTransactionId("75652561")
            .withStoredCredential(storedCredential)
            .withCardBrandStorage(StoredCredentialInitiator.Merchant, chargeCardBrandReference)
            .execute();

    // API raw response key "id"
    String transactionId = response.getTransactionId();
    // API raw response key "amount"
    BigDecimal amount = response.getBalanceAmount();
    // API raw response key "batch_id"
    String batchId = response.getBatchSummary().getBatchReference();
    // API raw response key "type"
    TransactionType transactionType = response.getTransactionReference().getOriginalTransactionType();
    // API raw response key "reference"
    String referenceNumber = response.getReferenceNumber();
    // API raw response key "status"
    String transactionStatus = response.getResponseMessage();
    // API raw response key "time_created"
    String timeCreated = response.getTimestamp();
    // API raw response key "action->result_code"
    String responseCode = response.getResponseCode();
    // API raw response key "payment_method->card->brand_reference"
    String cardBrandReference = response.getCardBrandTransactionId();
    // API raw response key "payment_method->card->authcode"
    String authCode = response.getAuthorizationCode();
    // API raw response key "payment_method->card->avs_postal_code_result"
    String avsResponseCode = response.getAvsResponseCode();
    // API raw response key "payment_method->card->->avs_address_result"
    String avsAddressResponse = response.getAvsAddressResponse();
    // API raw response key "payment_method->card->cvv_result"
    String cvnResponseMessage = response.getCvnResponseMessage();
    // API raw response key "payment_method->card->brand"();
    String cardType = response.getCardDetails().getBrand();
    // API raw response key "payment_method->card->masked_number_last4"
    String maskedNumberLast4 = response.getCardDetails().getMaskedNumberLast4();
    // API raw response key "payment_method->card->provider->result"
    String cardIssuerResult = response.getCardIssuerResponse().getResult();
    // API raw response key "payment_method->card->provider->cvv_result"
    String cardIssuerCvv = response.getCardIssuerResponse().getCvvResult();
    // API raw response key "payment_method->card->provider->avs_address_result"
    String cardIssuerAvsAddressResult = response.getCardIssuerResponse().getAvsAddressResult();
    // API raw response key "payment_method->card->provider->avs_postal_code_result"
    String cardIssuerAvsPostalCodeResult = response.getCardIssuerResponse().getAvsPostalCodeResult();
    // API raw response key "risk_assessment->mode"
    String fraudResponseMode = response.getFraudFilterResponse().getFraudResponseMode();
    // API raw response key "risk_assessment->result"
    String fraudResponseResult = response.getFraudFilterResponse().getFraudResponseResult();
    // API raw response key "risk_assessment->rules"
    List<FraudRule> fraudResponseRules = response.getFraudFilterResponse().getFraudResponseRules();
} catch (ApiException e) {
    // TODO: Add your exception handling here
} 
```
</Code>
<Code id="net" title=".NET" language="dotnet">
```
GpApiConfig config = new GpApiConfig
{
	AppId = "AppId",
	AppKey = "AppKey",
	Channel = Channel.CardNotPresent,
	Environment = Environment.TEST,
	Country = "IE"
};
ServicesContainer.ConfigureService(config);

CreditCardData card = new CreditCardData {
	Token = "PMT_7554986a-1e77-4c75-a80f-5889d0621c13",
	CardHolderName = "James Mason",
	ThreeDSecure = new ThreeDSecure {
		ProviderServerTransRef = "vJ9NXpFueXsAqeb4iAbJJbe+66s=",
		AuthenticationValue = "AAACBUGDZYYYIgGFGYNlAAAAAAA=",
		Eci = "05",
		MessageVersion = "2.1.0"
	}
};
StoredCredential storeCredentials = new StoredCredential
{
	Initiator = StoredCredentialInitiator.Merchant,
	Type = StoredCredentialType.Recurring,
	Sequence = StoredCredentialSequence.Subsequent
};
var cardBrandRef = "t9XevTa8Oia31WVL";
try
{
	Transaction response = card.Charge(1m)
		.WithCurrency("EUR")
		.WithClientTransactionId("75652561")
		.WithStoredCredential(storeCredentials)
		.WithCardBrandStorage(StoredCredentialInitiator.Merchant, cardBrandRef)
		.Execute(); 
	
	// API raw response key "id"
	var transactionId = response.TransactionId;
	// API raw response key "amount"
	var amount = response.AuthorizedAmount; 
	//API raw response key "batch_id"
	var batchId = response.BatchSummary.BatchReference;
	// API raw response key "reference"
	var referenceNumber = response.ReferenceNumber; 
	// API raw response key "status"
	var transactionStatus = response.ResponseMessage;
	// API raw response key "time_created"
	var timeCreated = response.Timestamp; 
	// API raw response key "action->result_code"
	var responseCode = response.ResponseCode; 
	//API raw response key "payment_method->card->brand_reference"
	var cardBrandReference = response.CardBrandTransactionId;
	// API raw response key "payment_method->card->authcode"
	var authCode = response.AuthorizationCode;
	// API raw response key "payment_method->card->cvv_result"
	var cvnResponseMessage = response.CvnResponseMessage;
	// API raw response key "payment_method->card->brand";
	var cardType = response.CardDetails.Brand;
	// API raw response key "payment_method->card->masked_number_last4"
	var maskedNumberLast4 = response.CardDetails.MaskedNumberLast4;
	//API raw response key "payment_method->card->provider->result"
	var cardIssuerResult = response.CardIssuerResponse.Result;
	//API raw response key "payment_method->card->provider->cvv_result"
	var cardIssuerCvv = response.CardIssuerResponse.CvvResult;
	//API raw response key "payment_method->card->provider->avs_address_result"
	var cardIssuerAvsAddressResult = response.CardIssuerResponse.AvsAddressResult;
	//API raw response key "payment_method->card->provider->avs_postal_code_result"
	var cardIssuerAvsPostalCodeResult = response.CardIssuerResponse.AvsPostalCodeResult;
	//API raw response key "risk_assessment->mode"
	var fraudResponseMode = response.FraudFilterResponse.FraudResponseMode;
	//API raw response key "risk_assessment->result"
	var fraudResponseResult = response.FraudFilterResponse.FraudResponseResult;
	//API raw response key "risk_assessment->rules"
	var fraudResponseRules = response.FraudFilterResponse.FraudResponseRules;
}
catch (GatewayException e)
{
	Console.WriteLine(e);
	throw;
}
```
</Code>
<Code id="PHP" title="PHP" language="php">
```
$config = new GpApiConfig();
$config->appId = 'appId';
$config->appKey = 'appKey';
$config->channel = Channel::CardNotPresent;
$config->country = 'IE';
$config->environment = Environment::TEST;
$config->requestLogger = new SampleRequestLogger(new Logger("logs"));

ServicesContainer::configureService($config);

$card = new CreditCardData();
$card->token = 'PMT_7554986a-1e77-4c75-a80f-5889d0621c13';
$card->cardHolderName = 'James Mason';

$storeCredentials = new StoredCredential();
$storeCredentials->initiator = StoredCredentialInitiator::MERCHANT;
$storeCredentials->type = StoredCredentialType::RECURRING;
$storeCredentials->sequence = StoredCredentialSequence::SUBSEQUENT;

$cardBrandReference = 't9XevTa8Oia31WVL';
try {
    $response = $card->charge(1)
        ->withCurrency("EUR")
        ->withClientTransactionId("75652561")
        ->withStoredCredential($storeCredentials)
        ->withCardBrandStorage(StoredCredentialInitiator::MERCHANT, $cardBrandReference)
        ->execute();
} catch (GatewayException $ex) {
    echo $ex->getMessage();
    exit();
    // TODO: Add your exception handling here
}

$transactionId = $response->transactionId; // API raw response key "id"
$amount = $response->authorizedAmount; // API raw response key "amount"
//API raw response key "batch_id"
$batchId = $response->batchSummary->batchReference;
//API raw response key "type"
$transactionType = $response->originalTransactionType;
$referenceNumber = $response->referenceNumber; // API raw response key "reference"
$transactionStatus = $response->responseMessage;// API raw response key "status"
$timeCreated = $response->timestamp; // API raw response key "time_created"
$responseCode = $response->responseCode; // API raw response key "action->result_code"
//API raw response key "payment_method->card->brand_reference"
$cardBrandReference = $response->cardBrandTransactionId;
// API raw response key "payment_method->card->authcode"
$authCode = $response->authorizationCode;
//API raw response key "payment_method->card->avs_postal_code_result"
$avsResponseCode = $response->avsResponseCode;
//API raw response key "payment_method->card->->avs_address_result"
$avsAddressResponse  = $response->avsAddressResponse;
// API raw response key "payment_method->card->cvv_result"
$cvnResponseMessage = $response->cvnResponseMessage;
// API raw response key "payment_method->card->brand";
$cardType = $response->cardDetails->brand;
// API raw response key "payment_method->card->masked_number_last4"
$maskedNumberLast4 = $response->cardDetails->maskedNumberLast4;
//API raw response key "payment_method->card->provider->result"
$cardIssuerResult = $response->cardIssuerResponse->result;
//API raw response key "payment_method->card->provider->cvv_result"
$cardIssuerCvv = $response->cardIssuerResponse->cvvResult;
//API raw response key "payment_method->card->provider->avs_address_result"
$cardIssuerAvsAddressResult = $response->cardIssuerResponse->avsAddressResult;
//API raw response key "payment_method->card->provider->avs_postal_code_result"
$cardIssuerAvsPostalCodeResult = $response->cardIssuerResponse->avsPostalCodeResult;
//API raw response key "risk_assessment->mode"
$fraudResponseMode = $response->fraudFilterResponse->fraudResponseMode;
//API raw response key "risk_assessment->result"
$fraudResponseResult = $response->fraudFilterResponse->fraudResponseResult;
//API raw response key "risk_assessment->rules"
$fraudResponseRules = $response->fraudFilterResponse->fraudResponseRules;
```
</Code>
</CodeGroup>

#### Sample response

<Code id="JSON" title="JSON" language="JSON" active>
```json
{
    "id": "TRN_xOPLdeWShj4YYqydi2Sn7HkQ3Gf3ZK_40424451",
    "time_created": "2022-05-20T17:38:17.637Z",
    "type": "SALE",
    "status": "CAPTURED",
    "channel": "CNP",
    "capture_mode": "AUTO",
    "amount": "100",
    "currency": "EUR",
    "country": "IE",
    "merchant_id": "MER_c4c0df11039c48a9b63701adeaa296c3",
    "merchant_name": "Sandbox_merchant_2",
    "account_id": "TRA_6716058969854a48b33347043ff8225f",
    "account_name": "Transaction_Processing",
    "reference": "40424451",
    "payment_method": {
        "result": "00",
        "message": "[ test system ] AUTHORISED",
        "entry_mode": "ECOM",
        "card": {
            "brand": "VISA",
            "masked_number_last4": "XXXXXXXXXXXX5262",
            "authcode": "12345",
            "brand_reference": "FB7P70xHebhcC7Rr",
            "brand_time_created": "",
            "provider": {
                "result": "00",
                "cvv_result": "M",
                "avs_address_result": "M",
                "avs_postal_code_result": "M"
            }
        }
    },
    "batch_id": "BAT_1092561",
    "action": {
        "id": "ACT_xOPLdeWShj4YYqydi2Sn7HkQ3Gf3ZK",
        "type": "AUTHORIZE",
        "time_created": "2022-05-20T17:38:17.637Z",
        "result_code": "SUCCESS",
        "app_id": "i9R0byBBor6RqTQNj3g4MuVBwH5rd7yR",
        "app_name": "demo_app"
    }
}
```
</Code>

### Auto account top-up

This use case is an MIT. For example, the merchant charges the customer’s card based on their account balance dropping below a certain threshold. In this case, we set the model to be Unscheduled. You must also supply the brand reference from the original authorization or verification when the card was first stored. 

When flagged correctly, MITs are deemed as out of scope for the European requirements for SCA. For more information, see our [Merchant-Initiated Transactions](/docs/MIT) article.

#### Sample request

<CodeGroup>
<Code id="JSON" title="JSON" language="JSON" active>
```json
curl --location --request POST 'https://apis.sandbox.globalpay.com/ucp/transactions' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer 2orSiiEoQc82EMBUNDyX1DS7guO3' \
--header 'Accept: application/json' \
--header 'X-GP-Version: 2021-03-22' \
--data-raw '{
    "account_id": "TRA_6716058969854a48b33347043ff8225f",
    "channel": "CNP",
    "type": "SALE",
    "amount": "100",
    "currency": "EUR",
    "reference": "01577731",
    "country": "IE",
    "initiator": "MERCHANT",
    "stored_credential": {
        "model": "UNSCHEDULED",
        "sequence": "SUBSEQUENT"
    },
    "payment_method": {
        "name": "James Mason",
        "entry_mode": "ECOM",
        "id": "PMT_850924e2-d2bd-4724-bb59-12ae1cec392d",
        "card": {
            "brand_reference": "wqIV3urYYTj5LkCT"
        }
    }
}'
```
</Code>
<Code id="java" title="JAVA" language="java">
```
GpApiConfig config = new GpApiConfig();
config.setAppId(APP_ID);
config.setAppKey(APP_KEY);
config.setChannel(Channel.CardNotPresent);
config.setCountry("IE");
config.setEnvironment(Environment.TEST);

ServicesContainer.configureService(config);

CreditCardData card = new CreditCardData();
card.setToken("PMT_7554986a-1e77-4c75-a80f-5889d0621c13");
card.setCardHolderName("James Mason");

StoredCredential storedCredential = new StoredCredential();
storedCredential.setInitiator(StoredCredentialInitiator.Merchant);
storedCredential.setType(StoredCredentialType.Unscheduled);
storedCredential.setSequence(StoredCredentialSequence.Subsequent);

String chargeCardBrandReference = "t9XevTa8Oia31WVL";

try {
    Transaction response = card.charge(new BigDecimal("1.00"))
            .withCurrency("EUR")
            .withClientTransactionId("01577731")
            .withStoredCredential(storedCredential)
            .withCardBrandStorage(StoredCredentialInitiator.Merchant, chargeCardBrandReference)
            .execute();

    // API raw response key "id"
    String transactionId = response.getTransactionId();
    // API raw response key "amount"
    BigDecimal amount = response.getBalanceAmount();
    // API raw response key "batch_id"
    String batchId = response.getBatchSummary().getBatchReference();
    // API raw response key "type"
    TransactionType transactionType = response.getTransactionReference().getOriginalTransactionType();
    // API raw response key "reference"
    String referenceNumber = response.getReferenceNumber();
    // API raw response key "status"
    String transactionStatus = response.getResponseMessage();
    // API raw response key "time_created"
    String timeCreated = response.getTimestamp();
    // API raw response key "action->result_code"
    String responseCode = response.getResponseCode();
    // API raw response key "payment_method->card->brand_reference"
    String cardBrandReference = response.getCardBrandTransactionId();
    // API raw response key "payment_method->card->authcode"
    String authCode = response.getAuthorizationCode();
    // API raw response key "payment_method->card->avs_postal_code_result"
    String avsResponseCode = response.getAvsResponseCode();
    // API raw response key "payment_method->card->->avs_address_result"
    String avsAddressResponse = response.getAvsAddressResponse();
    // API raw response key "payment_method->card->cvv_result"
    String cvnResponseMessage = response.getCvnResponseMessage();
    // API raw response key "payment_method->card->brand"();
    String cardType = response.getCardDetails().getBrand();
    // API raw response key "payment_method->card->masked_number_last4"
    String maskedNumberLast4 = response.getCardDetails().getMaskedNumberLast4();
    // API raw response key "payment_method->card->provider->result"
    String cardIssuerResult = response.getCardIssuerResponse().getResult();
    // API raw response key "payment_method->card->provider->cvv_result"
    String cardIssuerCvv = response.getCardIssuerResponse().getCvvResult();
    // API raw response key "payment_method->card->provider->avs_address_result"
    String cardIssuerAvsAddressResult = response.getCardIssuerResponse().getAvsAddressResult();
    // API raw response key "payment_method->card->provider->avs_postal_code_result"
    String cardIssuerAvsPostalCodeResult = response.getCardIssuerResponse().getAvsPostalCodeResult();
    // API raw response key "risk_assessment->mode"
    String fraudResponseMode = response.getFraudFilterResponse().getFraudResponseMode();
    // API raw response key "risk_assessment->result"
    String fraudResponseResult = response.getFraudFilterResponse().getFraudResponseResult();
    // API raw response key "risk_assessment->rules"
    List<FraudRule> fraudResponseRules = response.getFraudFilterResponse().getFraudResponseRules();
} catch (ApiException e) {
    // TODO: Add your exception handling here
} 
```
</Code>
<Code id="net" title=".NET" language="dotnet">
```
GpApiConfig config = new GpApiConfig
{
	AppId = "AppId",
	AppKey = "AppKey",
	Channel = Channel.CardNotPresent,
	Environment = Environment.TEST,
	Country = "IE"
};
ServicesContainer.ConfigureService(config);

CreditCardData card = new CreditCardData {
	Token = "PMT_7554986a-1e77-4c75-a80f-5889d0621c13",
	CardHolderName = "James Mason",
	ThreeDSecure = new ThreeDSecure {
		ProviderServerTransRef = "vJ9NXpFueXsAqeb4iAbJJbe+66s=",
		AuthenticationValue = "AAACBUGDZYYYIgGFGYNlAAAAAAA=",
		Eci = "05",
		MessageVersion = "2.1.0"
	}
};
StoredCredential storeCredentials = new StoredCredential
{
	Initiator = StoredCredentialInitiator.Merchant,
	Type = StoredCredentialType.Unscheduled,
	Sequence = StoredCredentialSequence.Subsequent
};
var cardBrandRef = "t9XevTa8Oia31WVL";
try
{
	Transaction response = card.Charge(1m)
		.WithCurrency("EUR")
		.WithClientTransactionId("01577731")
		.WithStoredCredential(storeCredentials)
		.WithCardBrandStorage(StoredCredentialInitiator.Merchant, cardBrandRef)
		.Execute(); 
	
	// API raw response key "id"
	var transactionId = response.TransactionId;
	// API raw response key "amount"
	var amount = response.AuthorizedAmount; 
	//API raw response key "batch_id"
	var batchId = response.BatchSummary.BatchReference;
	// API raw response key "reference"
	var referenceNumber = response.ReferenceNumber; 
	// API raw response key "status"
	var transactionStatus = response.ResponseMessage;
	// API raw response key "time_created"
	var timeCreated = response.Timestamp; 
	// API raw response key "action->result_code"
	var responseCode = response.ResponseCode; 
	//API raw response key "payment_method->card->brand_reference"
	var cardBrandReference = response.CardBrandTransactionId;
	// API raw response key "payment_method->card->authcode"
	var authCode = response.AuthorizationCode;
	// API raw response key "payment_method->card->cvv_result"
	var cvnResponseMessage = response.CvnResponseMessage;
	// API raw response key "payment_method->card->brand";
	var cardType = response.CardDetails.Brand;
	// API raw response key "payment_method->card->masked_number_last4"
	var maskedNumberLast4 = response.CardDetails.MaskedNumberLast4;
	//API raw response key "payment_method->card->provider->result"
	var cardIssuerResult = response.CardIssuerResponse.Result;
	//API raw response key "payment_method->card->provider->cvv_result"
	var cardIssuerCvv = response.CardIssuerResponse.CvvResult;
	//API raw response key "payment_method->card->provider->avs_address_result"
	var cardIssuerAvsAddressResult = response.CardIssuerResponse.AvsAddressResult;
	//API raw response key "payment_method->card->provider->avs_postal_code_result"
	var cardIssuerAvsPostalCodeResult = response.CardIssuerResponse.AvsPostalCodeResult;
	//API raw response key "risk_assessment->mode"
	var fraudResponseMode = response.FraudFilterResponse.FraudResponseMode;
	//API raw response key "risk_assessment->result"
	var fraudResponseResult = response.FraudFilterResponse.FraudResponseResult;
	//API raw response key "risk_assessment->rules"
	var fraudResponseRules = response.FraudFilterResponse.FraudResponseRules;
}
catch (GatewayException e)
{
	Console.WriteLine(e);
	throw;
}
```
</Code>
<Code id="PHP" title="PHP" language="php">
```
$config = new GpApiConfig();
$config->appId = 'appId';
$config->appKey = 'appKey';
$config->channel = Channel::CardNotPresent;
$config->country = 'IE';
$config->environment = Environment::TEST;
$config->requestLogger = new SampleRequestLogger(new Logger("logs"));

ServicesContainer::configureService($config);

$card = new CreditCardData();
$card->token = 'PMT_7554986a-1e77-4c75-a80f-5889d0621c13';
$card->cardHolderName = 'James Mason';

$storeCredentials = new StoredCredential();
$storeCredentials->initiator = StoredCredentialInitiator::MERCHANT;
$storeCredentials->type = StoredCredentialType::UNSCHEDULED;
$storeCredentials->sequence = StoredCredentialSequence::SUBSEQUENT;

$cardBrandReference = 't9XevTa8Oia31WVL';
try {
    $response = $card->charge(1)
        ->withCurrency("EUR")
        ->withClientTransactionId("01577731")
        ->withStoredCredential($storeCredentials)
        ->withCardBrandStorage(StoredCredentialInitiator::MERCHANT, $cardBrandReference)
        ->execute();
} catch (GatewayException $ex) {
    echo $ex->getMessage();
    exit();
    // TODO: Add your exception handling here
}

$transactionId = $response->transactionId; // API raw response key "id"
$amount = $response->authorizedAmount; // API raw response key "amount"
//API raw response key "batch_id"
$batchId = $response->batchSummary->batchReference;
//API raw response key "type"
$transactionType = $response->originalTransactionType;
$referenceNumber = $response->referenceNumber; // API raw response key "reference"
$transactionStatus = $response->responseMessage;// API raw response key "status"
$timeCreated = $response->timestamp; // API raw response key "time_created"
$responseCode = $response->responseCode; // API raw response key "action->result_code"
//API raw response key "payment_method->card->brand_reference"
$cardBrandReference = $response->cardBrandTransactionId;
// API raw response key "payment_method->card->authcode"
$authCode = $response->authorizationCode;
//API raw response key "payment_method->card->avs_postal_code_result"
$avsResponseCode = $response->avsResponseCode;
//API raw response key "payment_method->card->->avs_address_result"
$avsAddressResponse  = $response->avsAddressResponse;
// API raw response key "payment_method->card->cvv_result"
$cvnResponseMessage = $response->cvnResponseMessage;
// API raw response key "payment_method->card->brand";
$cardType = $response->cardDetails->brand;
// API raw response key "payment_method->card->masked_number_last4"
$maskedNumberLast4 = $response->cardDetails->maskedNumberLast4;
//API raw response key "payment_method->card->provider->result"
$cardIssuerResult = $response->cardIssuerResponse->result;
//API raw response key "payment_method->card->provider->cvv_result"
$cardIssuerCvv = $response->cardIssuerResponse->cvvResult;
//API raw response key "payment_method->card->provider->avs_address_result"
$cardIssuerAvsAddressResult = $response->cardIssuerResponse->avsAddressResult;
//API raw response key "payment_method->card->provider->avs_postal_code_result"
$cardIssuerAvsPostalCodeResult = $response->cardIssuerResponse->avsPostalCodeResult;
//API raw response key "risk_assessment->mode"
$fraudResponseMode = $response->fraudFilterResponse->fraudResponseMode;
//API raw response key "risk_assessment->result"
$fraudResponseResult = $response->fraudFilterResponse->fraudResponseResult;
//API raw response key "risk_assessment->rules"
$fraudResponseRules = $response->fraudFilterResponse->fraudResponseRules;
```
</Code>
</CodeGroup>

#### Sample response

<Code id="JSON" title="JSON" language="JSON" active>
```json
{
    "id": "TRN_J69gReLKy8dP1p5WgdVLLnX7xADx8y_01577731",
    "time_created": "2022-05-20T17:43:28.196Z",
    "type": "SALE",
    "status": "CAPTURED",
    "channel": "CNP",
    "capture_mode": "AUTO",
    "amount": "100",
    "currency": "EUR",
    "country": "IE",
    "merchant_id": "MER_c4c0df11039c48a9b63701adeaa296c3",
    "merchant_name": "Sandbox_merchant_2",
    "account_id": "TRA_6716058969854a48b33347043ff8225f",
    "account_name": "Transaction_Processing",
    "reference": "01577731",
    "payment_method": {
        "result": "00",
        "message": "[ test system ] AUTHORISED",
        "entry_mode": "ECOM",
        "card": {
            "brand": "VISA",
            "masked_number_last4": "XXXXXXXXXXXX5262",
            "authcode": "12345",
            "brand_reference": "0sJ211EAr8pEp7dy",
            "brand_time_created": "",
            "provider": {
                "result": "00",
                "cvv_result": "M",
                "avs_address_result": "M",
                "avs_postal_code_result": "M"
            }
        }
    },
    "batch_id": "BAT_1092561",
    "action": {
        "id": "ACT_J69gReLKy8dP1p5WgdVLLnX7xADx8y",
        "type": "AUTHORIZE",
        "time_created": "2022-05-20T17:43:28.196Z",
        "result_code": "SUCCESS",
        "app_id": "i9R0byBBor6RqTQNj3g4MuVBwH5rd7yR",
        "app_name": "demo_app"
    }
}
```
</Code>
